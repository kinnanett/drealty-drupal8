<?php

/**
 * @file
 * DRealty module.
 */

use \Drupal\drealty\Entity\ConnectionEntity;

/**
 * Implements hook_permission().
 */
function drealty_permission() {
  $return = array();

  $return['administer drealty connections'] = array(
    'title' => t('Administer DRealty Connections'),
    'restrict access' => TRUE,
  );


  $return['administer drealty listing types'] = array(
    'title' => t('Administer DRealty Listing Types'),
    'restrict access' => TRUE,
  );

  return $return;
}

/**
 * Menu argument loader. Returns a DRealty Connection entity.
 *
 * @param $id
 * @return \Drupal\drealty\ConnectionInterface;
 */
function drealty_connection_load($id) {
  return ConnectionEntity::load($id);
}

/**
 * Implements hook_toolbar_alter().
 */
function drealty_toolbar_alter(&$items) {
  if (isset($items['administration']['tray'])) {
    $items['administration']['tray']['#attached']['css'][] = drupal_get_path('module', 'drealty') . '/assets/css/drealty.admin.css';
  }
}

/**
 * Updates all listings of one type to be of another type.
 *
 * @param string $old_id
 *   The current listing type of the listings.
 * @param string $new_id
 *   The new listing type of the listings.
 *
 * @return
 *   The number of listings whose listing type field was modified.
 */
function drealty_listing_type_update_listings($old_id, $new_id) {
  return \Drupal::entityManager()->getStorage('drealty_listing')->updateType($old_id, $new_id);
}
